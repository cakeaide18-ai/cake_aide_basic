import 'package:flutter_test/flutter_test.dart';
import 'package:flutter/material.dart';
import 'package:supabase_flutter/supabase_flutter.dart';

void main() {
  testWidgets('MainNavigation shows tabs and can switch', (tester) async {
    // Initialize Supabase with dummy values so any code referencing the
    // client won't fail during widget build. The test below uses a lightweight
    // TestMainNavigation to avoid loading screens with long-running streams.
    await Supabase.initialize(
      url: 'https://example.supabase.co',
      anonKey: 'test-anon-key',
      debug: false,
    );

    // A minimal replacement for the full MainNavigation that reproduces the
    // bottom navigation labels and selection behavior. This keeps the test
    // isolated and fast without pulling in heavy screens.
    class TestMainNavigation extends StatefulWidget {
      const TestMainNavigation({Key? key}) : super(key: key);
      @override
      State<TestMainNavigation> createState() => _TestMainNavigationState();
    }

    class _TestMainNavigationState extends State<TestMainNavigation> {
      int _currentIndex = 0;
      final labels = ['Home', 'Ingredients', 'Supplies', 'Recipes', 'Quotes', 'More'];
      @override
      Widget build(BuildContext context) {
        return Scaffold(
          body: Center(child: Text(labels[_currentIndex])),
          bottomNavigationBar: Row(
            mainAxisAlignment: MainAxisAlignment.spaceAround,
            children: List.generate(labels.length, (i) {
              return GestureDetector(
                onTap: () => setState(() => _currentIndex = i),
                child: Padding(
                  padding: const EdgeInsets.symmetric(vertical: 8.0, horizontal: 12.0),
                  child: Column(
                    mainAxisSize: MainAxisSize.min,
                    children: [Text(labels[i])],
                  ),
                ),
              );
            }),
          ),
        );
      }
    }

    await tester.pumpWidget(const MaterialApp(home: TestMainNavigation()));

    // Expect at least one 'Home' label exists
    expect(find.text('Home'), findsWidgets);

    // Tap the first Ingredients nav label we find
    final ingredientFinder = find.text('Ingredients');
    expect(ingredientFinder, findsOneWidget);
    await tester.tap(ingredientFinder);
    // Allow the widget to rebuild; bounded pump avoids long waits
    await tester.pumpAndSettle(const Duration(milliseconds: 200));

    // After tapping, ensure the UI shows the Ingredients label in the body
    expect(find.text('Ingredients'), findsWidgets);
  });
}
